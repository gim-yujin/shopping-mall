<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head><title>관리자 대시보드</title></head>
<body>
<div layout:fragment="content">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">관리자 대시보드</h1>

        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-5">
                <p class="text-sm text-gray-500">전체 상품</p>
                <p class="text-2xl font-bold mt-1" th:text="${products.totalElements}">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-5">
                <p class="text-sm text-gray-500">전체 주문</p>
                <p class="text-2xl font-bold mt-1" th:text="${recentOrders.totalElements}">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-5">
                <p class="text-sm text-gray-500">신규 주문</p>
                <p class="text-2xl font-bold mt-1 text-blue-600" th:text="${recentOrders.content.size()}">0</p>
            </div>
            <!--
                [Step 5] 반품 대기 건수 카드.

                문제: 관리자 대시보드에 반품 대기 건수가 표시되지 않아
                미처리 반품이 쌓여도 관리자가 인지하기 어려웠다.

                해결: pendingReturnCount를 카드로 표시하고, '관리하기' 링크로
                반품 관리 페이지(/admin/returns)에 바로 접근할 수 있도록 한다.
                건수가 0보다 크면 주황색 강조로 긴급도를 시각적으로 표현한다.
            -->
            <div class="bg-white rounded-lg shadow p-5 border-l-4 border-orange-400">
                <p class="text-sm text-orange-600">반품 대기</p>
                <p class="text-2xl font-bold mt-1"
                   th:classappend="${pendingReturnCount > 0 ? 'text-orange-600' : ''}"
                   th:text="${pendingReturnCount}">0</p>
                <a th:href="@{/admin/returns}" class="text-xs text-orange-500 hover:text-orange-700">관리하기 →</a>
            </div>
            <div class="bg-white rounded-lg shadow p-5">
                <p class="text-sm text-gray-500">관리</p>
                <div class="flex gap-2 mt-2">
                    <a th:href="@{/admin/products}" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">상품</a>
                    <a th:href="@{/admin/orders}" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">주문</a>
                    <a th:href="@{/admin/coupons}" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">쿠폰</a>
                    <a th:href="@{/admin/points}" class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded">포인트</a>
                </div>
            </div>
        </div>

        <!-- [3.11] 쿠폰 통계 카드 -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-5 border-l-4 border-purple-500">
                <p class="text-sm text-gray-500">전체 쿠폰</p>
                <p class="text-2xl font-bold mt-1" th:text="${couponStats.totalCoupons()}">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-5 border-l-4 border-green-500">
                <p class="text-sm text-gray-500">활성 쿠폰</p>
                <p class="text-2xl font-bold mt-1 text-green-600" th:text="${couponStats.activeCoupons()}">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-5 border-l-4 border-blue-500">
                <p class="text-sm text-gray-500">총 발급 / 사용</p>
                <p class="text-2xl font-bold mt-1">
                    <span th:text="${couponStats.totalIssued()}">0</span>
                    <span class="text-gray-400 text-base">/</span>
                    <span class="text-blue-600" th:text="${couponStats.totalUsed()}">0</span>
                </p>
            </div>
            <div class="bg-white rounded-lg shadow p-5 border-l-4 border-amber-500">
                <p class="text-sm text-gray-500">쿠폰 사용률</p>
                <p class="text-2xl font-bold mt-1 text-amber-600"
                   th:text="${#numbers.formatDecimal(couponStats.usageRate(), 1, 1)} + '%'">0%</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Recent Orders -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold">최근 주문</h2>
                    <a th:href="@{/admin/orders}" class="text-sm text-blue-600 hover:text-blue-800">전체보기 →</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead><tr class="border-b text-left text-gray-500">
                            <th class="py-2">주문번호</th><th>일시</th><th>금액</th><th>상태</th>
                        </tr></thead>
                        <tbody>
                        <tr th:each="order : ${recentOrders.content}" class="border-b last:border-0">
                            <td class="py-2 font-medium" th:text="${order.orderNumber}">ORD</td>
                            <td class="text-gray-500" th:text="${#temporals.format(order.orderDate, 'MM.dd HH:mm')}">날짜</td>
                            <td th:text="${#numbers.formatDecimal(order.finalAmount,0,'COMMA',0,'POINT')} + '원'">0원</td>
                            <td><span class="px-2 py-0.5 text-xs rounded-full"
                                      th:classappend="${order.orderStatus.badgeClass}"
                                      th:text="${order.orderStatus.label}">STATUS</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold">상품 목록</h2>
                    <a th:href="@{/admin/products}" class="text-sm text-blue-600 hover:text-blue-800">전체보기 →</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead><tr class="border-b text-left text-gray-500">
                            <th class="py-2">상품명</th><th>가격</th><th>재고</th><th>판매</th>
                        </tr></thead>
                        <tbody>
                        <tr th:each="product : ${products.content}" class="border-b last:border-0">
                            <td class="py-2 font-medium max-w-[150px] truncate" th:text="${product.productName}">상품명</td>
                            <td th:text="${#numbers.formatDecimal(product.price,0,'COMMA',0,'POINT')} + '원'">0원</td>
                            <td th:classappend="${product.stockQuantity < 10 ? 'text-red-600 font-bold' : ''}" th:text="${product.stockQuantity}">0</td>
                            <td th:text="${product.salesCount}">0</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- [3.11] 쿠폰 현황 바 -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">쿠폰 현황</h2>
                <a th:href="@{/admin/coupons}" class="text-sm text-purple-600 hover:text-purple-800">쿠폰 관리 →</a>
            </div>
            <div class="grid grid-cols-4 gap-4 text-center text-sm">
                <div>
                    <p class="text-gray-500">등록</p>
                    <p class="text-lg font-bold" th:text="${couponStats.totalCoupons()}">0</p>
                </div>
                <div>
                    <p class="text-gray-500">활성</p>
                    <p class="text-lg font-bold text-green-600" th:text="${couponStats.activeCoupons()}">0</p>
                </div>
                <div>
                    <p class="text-gray-500">발급</p>
                    <p class="text-lg font-bold text-blue-600" th:text="${couponStats.totalIssued()}">0</p>
                </div>
                <div>
                    <p class="text-gray-500">사용</p>
                    <p class="text-lg font-bold text-amber-600" th:text="${couponStats.totalUsed()}">0</p>
                </div>
            </div>
            <!-- 사용률 프로그레스 바 -->
            <div class="mt-4">
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span>쿠폰 사용률</span>
                    <span th:text="${#numbers.formatDecimal(couponStats.usageRate(), 1, 1)} + '%'">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-purple-500 h-2 rounded-full transition-all"
                         th:style="'width:' + ${couponStats.usageRate()} + '%'"></div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
