<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head><title>쿠폰</title></head>
<body>
<div layout:fragment="content">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">쿠폰</h1>

        <!-- Coupon Code Input -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-lg font-medium mb-3">쿠폰 등록</h2>
            <form th:action="@{/coupons/issue}" method="post" class="flex gap-3">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="text" name="couponCode" placeholder="쿠폰 코드를 입력하세요" required class="flex-1 border rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/>
                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex-shrink-0">등록</button>
            </form>
        </div>

        <!-- Available Coupons -->
        <div class="mb-8">
            <h2 class="text-lg font-bold mb-4">발급 가능한 쿠폰 <span class="text-sm font-normal text-gray-500" th:text="'(' + ${availableCoupons.totalElements} + '개)'">(0개)</span></h2>
            <div th:if="${availableCoupons.totalElements == 0}" class="text-center py-8 text-gray-500">발급 가능한 쿠폰이 없습니다.</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div th:each="coupon : ${availableCoupons.content}" class="border-2 border-dashed border-blue-300 rounded-lg p-5 bg-blue-50 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs px-3 py-1 rounded-bl-lg"
                         th:text="${coupon.discountType == 'PERCENT' ? coupon.discountValue + '%' : #numbers.formatDecimal(coupon.discountValue,0,'COMMA',0,'POINT') + '원'}">할인</div>
                    <h3 class="font-bold text-gray-900 pr-16" th:text="${coupon.couponName}">쿠폰명</h3>
                    <p class="text-sm text-gray-500 mt-1" th:text="'최소 주문금액: ' + ${#numbers.formatDecimal(coupon.minOrderAmount,0,'COMMA',0,'POINT')} + '원'">조건</p>
                    <p class="text-xs text-gray-400 mt-1" th:text="'유효기간: ' + ${#temporals.format(coupon.validFrom, 'MM.dd')} + ' ~ ' + ${#temporals.format(coupon.validUntil, 'MM.dd')}">기간</p>
                    <div class="mt-3">
                        <span th:if="${issuedCouponIds.contains(coupon.couponId)}"
                              class="inline-block text-xs text-gray-400 border border-gray-300 rounded-full px-4 py-1.5">발급완료</span>
                        <form th:unless="${issuedCouponIds.contains(coupon.couponId)}"
                              th:action="@{/coupons/issue/{id}(id=${coupon.couponId})}" method="post" class="inline">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit"
                                    class="text-xs text-white bg-blue-600 hover:bg-blue-700 rounded-full px-4 py-1.5 transition font-medium">쿠폰 받기</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Pagination -->
            <div th:if="${availableCoupons.totalPages > 1}" class="flex justify-center items-center gap-2 mt-6">
                <a th:unless="${availableCoupons.first}" th:href="@{/coupons(availablePage=${availableCoupons.number - 1},myPage=${myCoupons.number})}"
                   class="px-3 py-2 rounded-lg border bg-white text-gray-700 hover:bg-gray-50 text-sm">← 이전</a>
                <span class="px-3 py-2 text-sm text-gray-600"
                      th:text="${(availableCoupons.number + 1) + ' / ' + availableCoupons.totalPages + ' 페이지'}">1 / 100 페이지</span>
                <a th:unless="${availableCoupons.last}" th:href="@{/coupons(availablePage=${availableCoupons.number + 1},myPage=${myCoupons.number})}"
                   class="px-3 py-2 rounded-lg border bg-white text-gray-700 hover:bg-gray-50 text-sm">다음 →</a>
            </div>
        </div>

        <!-- My Coupons -->
        <div>
            <h2 class="text-lg font-bold mb-4">보유 쿠폰 <span class="text-sm font-normal text-gray-500" th:text="'(' + ${myCoupons.totalElements} + '개)'">(0개)</span></h2>
            <div th:if="${myCoupons.totalElements == 0}" class="text-center py-8 text-gray-500">보유한 쿠폰이 없습니다.</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div th:each="uc : ${myCoupons.content}" class="rounded-lg p-5 relative overflow-hidden"
                     th:classappend="${uc.isUsed ? 'bg-gray-100 border border-gray-200 opacity-60' : 'bg-white border-2 border-blue-200 shadow'}">
                    <span th:if="${uc.isUsed}" class="absolute top-3 right-3 text-xs bg-gray-400 text-white px-2 py-0.5 rounded">사용완료</span>
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-600 text-white rounded-lg w-16 h-16 flex items-center justify-center flex-shrink-0">
                            <span class="text-sm font-bold"
                                  th:text="${uc.coupon.discountType == 'PERCENT' ? uc.coupon.discountValue + '%' : #numbers.formatDecimal(uc.coupon.discountValue,0,'COMMA',0,'POINT') + '원'}">할인</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-900" th:text="${uc.coupon.couponName}">쿠폰명</h3>
                            <p class="text-sm text-gray-500 mt-0.5" th:text="'최소 주문금액: ' + ${#numbers.formatDecimal(uc.coupon.minOrderAmount,0,'COMMA',0,'POINT')} + '원'">조건</p>
                            <p class="text-xs text-gray-400 mt-0.5" th:text="'만료: ' + ${#temporals.format(uc.expiresAt, 'yyyy.MM.dd')}">만료일</p>
                        </div>
                    </div>
                </div>
            </div>
            <div th:if="${myCoupons.totalPages > 1}" class="flex justify-center items-center gap-2 mt-6">
                <a th:unless="${myCoupons.first}" th:href="@{/coupons(availablePage=${availableCoupons.number},myPage=${myCoupons.number - 1})}"
                   class="px-3 py-2 rounded-lg border bg-white text-gray-700 hover:bg-gray-50 text-sm">← 이전</a>
                <span class="px-3 py-2 text-sm text-gray-600"
                      th:text="${(myCoupons.number + 1) + ' / ' + myCoupons.totalPages + ' 페이지'}">1 / 100 페이지</span>
                <a th:unless="${myCoupons.last}" th:href="@{/coupons(availablePage=${availableCoupons.number},myPage=${myCoupons.number + 1})}"
                   class="px-3 py-2 rounded-lg border bg-white text-gray-700 hover:bg-gray-50 text-sm">다음 →</a>
            </div>

        </div>
    </div>
</div>
</body>
</html>
